<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CHashTable: Specification</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CHashTable<span id="projectnumber">&#160;1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2specification.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Specification</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1"></a> </p>
<h1><a class="anchor" id="autotoc_md2"></a>
What is a hash table?</h1>
<p>A hash table stores data in <b>key-value pairs</b>. This means that each piece of data (value) has an associated key. The main benefit of a hash table is that, if the key is known, we can retrieve its associated value close to <code>O(1)</code> (constant) time. This is much faster than searching through an array to find something which has a time complexity of <code>O(n)</code>. However, this advantage comes at the cost of wasted memory.</p>
<p>A good hash table implementation should:</p><ul>
<li>Insert, retrieve, and delete data close to <code>O(1)</code> time</li>
<li>Waste as little memory as possible and keep the unused table slots at a minimum</li>
<li>Distribute the data evenly across the table</li>
<li>Have a good resizing strategy</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Implementation details</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Hash function</h2>
<p>For simplicity, I've chosen the <b>division method</b>, which works by dividing the key by the table size and taking the remainder. <code>hash = key % table_size</code>.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Collision handling</h2>
<p>A collision occurs when two different keys produce the same hash. To handle this, I have chosen the method of using <b>linked lists</b>. Each table slot contains a pointer to a linked list. Colliding entries are appended to the list. When we want to retrieve or delete an element, we traverse through the linked list until we find the key.</p>
<p>Worst case, this produces an <code>O(n)</code> search time but with a good hash function the list should be relatively short. This provides a close to constant search time.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Table size, resizing</h2>
<p>The table size should always be a <b>prime number</b>. This prevents the table size and the keys from having a common factor. This gives an even distribution across the table. The initial size is <b>53</b>.</p>
<p>When the table starts to fill up, it needs to be resized. To decide when to resize, we calculate the <b>load factor</b>: <code>load_factor = total_number_of_entries / current_table_size</code>. When load factor exceeds <b>0.75</b> after an insertion, the table is immediately resized. The next table size is calculated by first doubling the current size, then finding the closest prime that is larger than the new size.</p>
<p>All existing entries must be rehashed into the new table using the new table size.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Memory allocation</h2>
<p>Because the table size can be increased, the hash table must be dynamically allocated on the <b>heap</b>. When increasing the size, the old table array is freed after all entries are migrated to new table.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Load factor calculation</h2>
<p>Formula: <code>load_factor = total_number_of_entries / current_table_size</code></p>
<p>Calculated after each insertion.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Key-value storage</h2>
<ul>
<li>Key data type: <code>int</code></li>
<li>Value data type: <code>int</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md10"></a>
Insert, search, delete behavior</h2>
<ul>
<li>When inserting first we check if the key exists. If so the existing entry is updated. Otherwise the new entry is prepended to the head of the list.</li>
<li>The deletion function should return whether it was able to delete the data entry.</li>
<li>The get method returns a pointer to the entry or <code>NULL</code> if it wasn't found.</li>
<li>The hash table should be able to completely free itself from memory. Including all linked list nodes, and the buckets array.</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
Iteration</h2>
<p>The hash table has a foreach function that iterates over all key-value pairs. The iteration order is not guaranteed (depends on hash function and bucket order). The foreach function accepts a callback function with signature: <code>void callback(int key, int value, void* user_data)</code>. The callback is invoked once for each key-value pair in the table.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Data persistence</h1>
<p>The hash table can be saved and loaded into a <code>.txt</code> file.</p>
<p><b>File format</b> </p><div class="fragment"><div class="line">count</div>
<div class="line">key1 value1</div>
<div class="line">key2 value2</div>
<div class="line">key3 value3</div>
<div class="line">...</div>
</div><!-- fragment --><p>The <code>count</code> is the total number of key-value pairs.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Serialization</h2>
<p>The foreach function iterates over all key-value pairs and writes them to the file.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Deserialization</h2>
<ol type="1">
<li>Read the count from the first line</li>
<li>Create a new empty hash table with initial size: <code>next_prime(count / 0.75)</code> (optimization to avoid resizing during load)</li>
<li>Read and insert each key-value pair using the standard insert function</li>
<li>Return the newly created hash table </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
